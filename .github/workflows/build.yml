# .github/workflows/build.yml (للتجربة فقط)

name: AHK Isolation Test

on:
  workflow_dispatch: # سنجعله يعمل يدويًا فقط

jobs:
  isolation-test:
    runs-on: windows-latest

    steps:
      # الخطوة 1: جلب الأكشن فقط، لا نحتاج باقي الملفات الآن
      - name: Checkout repository
        uses: actions/checkout@v4

      # الخطوة 2: إنشاء سكربت اختبار بسيط جداً
      - name: Create a minimal test script
        run: Set-Content -Path "test.ahk" -Value '#Requires AutoHotkey v2.0`r`nMsgBox "Test successful!"'
        shell: pwsh
      
      # الخطوة 3: استدعاء الأكشن لتجميع سكربت الاختبار (بدون أيقونة)
      - name: Compile the minimal test script
        id: compile
        uses: ./.github/actions/ahk-compiler
        with:
          script_file: 'test.ahk'
          output_file: 'release/Test.exe'
          architecture: 'x64'
          # لاحظ أننا حذفنا سطر الأيقونة عن قصد للتبسيط

      # الخطوة 4: رفع الملف الناتج إذا نجح
      - name: Upload Test Executable
        uses: actions/upload-artifact@v4
        with:
          name: test-app
          path: release/Test.exe