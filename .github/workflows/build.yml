name: Build AHK Script (Manual Install)

on:
  push:
    branches: [ "main" ]
  workflow_dispatch:

jobs:
  build:
    runs-on: windows-latest

    steps:
    # الخطوة 1: الحصول على كود المستودع
    - name: Checkout code
      uses: actions/checkout@v4

    # الخطوة 2: تحميل، فك ضغط، وتثبيت AutoHotkey v2 بشكل صامت
    - name: Download, Extract, and Install AutoHotkey
      shell: pwsh
      run: |
        # تحميل الملف المضغوط
        Invoke-WebRequest -Uri "https://www.autohotkey.com/download/ahk-v2.zip" -OutFile "autohotkey.zip"
        # فك الضغط في مجلد اسمه ahk
        Expand-Archive -Path "autohotkey.zip" -DestinationPath "ahk"
        # الدخول إلى المجلد الذي تم فك ضغطه
        Set-Location "ahk"
        # *** تشغيل التثبيت الصامت ***
        # هذا هو السطر الأهم. يقوم بتثبيت البرنامج دون أي نوافذ أو أسئلة
        & .\install.cmd /S
        
    # الخطوة 3: تحويل السكربت. الآن Ahk2Exe موجود ومتاح في النظام
    # لا حاجة لتغيير أي شيء هنا لأن المثبت يضيف المسار الصحيح تلقائياً
    - name: Compile AHK script
      run: |
        Ahk2Exe.exe /in "Playback.ahk" /out "Playback.exe" /icon "play_pause_icon_137298.ico"
        
    # الخطوة 4: رفع الملف الناتج
    - name: Upload executable
      uses: actions/upload-artifact@v4
      with:
        name: Compiled-Program
        path: Playback.exe