name: Build AHK Script (Manual Install)

on:
  push:
    branches: [ "main" ]
  workflow_dispatch:

jobs:
  build:
    runs-on: windows-latest

    steps:
    # الخطوة 1: الحصول على كود المستودع
    - name: Checkout code
      uses: actions/checkout@v4

    # الخطوة 2: تحميل، فك ضغط، وتثبيت AutoHotkey v2 بشكل صامت
    - name: Download, Extract, and Install AutoHotkey
      shell: pwsh
      run: |
        # === الرابط المباشر الجديد من GitHub ===
        $ahkUrl = "https://github.com/AutoHotkey/AutoHotkey/releases/download/v2.0.19/AutoHotkey_2.0.19.zip"
        $ahkZip = "autohotkey.zip"

        # تحميل الملف مباشرة (سيعمل الآن بدون مشاكل)
        Invoke-WebRequest -Uri $ahkUrl -OutFile $ahkZip

        # فك الضغط في مجلد اسمه ahk
        Expand-Archive -Path $ahkZip -DestinationPath "ahk"

        # الدخول إلى المجلد
        Set-Location "ahk"
        
        # تشغيل التثبيت الصامت
        & .\install.cmd /S
        
    # الخطوة 3: تحويل السكربت. الآن Ahk2Exe موجود ومتاح في النظام
    # لا حاجة لتغيير أي شيء هنا لأن المثبت يضيف المسار الصحيح تلقائياً
    - name: Compile AHK script
      run: |
        Set-Location "Compiler"
        
        Ahk2Exe.exe /in "Playback.ahk" /out "Playback.exe" /icon "play_pause_icon_137298.ico"
        
    # الخطوة 4: رفع الملف الناتج
    - name: Upload executable
      uses: actions/upload-artifact@v4
      with:
        name: Compiled-Program
        path: Playback.exe