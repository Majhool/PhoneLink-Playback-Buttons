name: Build AutoHotkey Script (Final Version)

on:
  push:
    branches: [ "main" ]
  workflow_dispatch:

jobs:
  build:
    runs-on: windows-latest

    steps:
    # الخطوة 1: الحصول على الكود
    - name: Checkout code
      uses: actions/checkout@v4

    # الخطوة 2: تحميل وتثبيت AutoHotkey
    - name: Install AutoHotkey
      shell: pwsh
      run: |
        $ahkUrl = "https://github.com/AutoHotkey/AutoHotkey/releases/download/v2.0.19/AutoHotkey_2.0.19.zip"
        $ahkZip = "autohotkey.zip"
        Invoke-WebRequest -Uri $ahkUrl -OutFile $ahkZip
        Expand-Archive -Path $ahkZip -DestinationPath "ahk"
        Set-Location "ahk"
        & .\install.cmd /S
        
    # الخطوة 3: تحويل السكربت (بالطريقة المضمونة)
    - name: Compile AHK script
      shell: pwsh
      run: |
        # أولاً: ننتقل إلى مجلد المحول مباشرةً
        Set-Location "C:\Program Files\AutoHotkey\Compiler"
        
        # ثانياً: ننفذ الأمر من داخل المجلد
        # نستخدم GITHUB_WORKSPACE لنضمن أن مسارات ملفاتك صحيحة
        & .\Ahk2Exe.exe /in "$($env:GITHUB_WORKSPACE)\Playback.ahk" /out "$($env:GITHUB_WORKSPACE)\Playback.exe" /icon "$($env:GITHUB_WORKSPACE)\play_pause_icon_137298.ico"
        
    # الخطوة 4: رفع الملف الناتج
    - name: Upload executable
      uses: actions/upload-artifact@v4
      with:
        name: Compiled-Program
        path: Playback.exe