name: System State Inspection

on:
  workflow_dispatch:

jobs:
  inspect:
    runs-on: windows-latest

    steps:
    # الخطوة 1: تثبيت AutoHotkey كالمعتاد
    - name: Install AutoHotkey
      shell: pwsh
      run: |
        $ahkUrl = "https://github.com/AutoHotkey/AutoHotkey/releases/download/v2.0.19/AutoHotkey_2.0.19.zip"
        $ahkZip = "autohotkey.zip"
        Invoke-WebRequest -Uri $ahkUrl -OutFile $ahkZip
        Expand-Archive -Path $ahkZip -DestinationPath "ahk"
        Set-Location "ahk"
        & .\install.cmd /S
        
    # الخطوة 2: طباعة معلومات النظام بعد التثبيت
    - name: List Installed Files and Environment
      shell: pwsh
      run: |
        Write-Output "=================================================="
        Write-Output "LISTING ENVIRONMENT VARIABLES (looking for PATH changes)"
        Write-Output "=================================================="
        Get-ChildItem Env:

        Write-Output "=================================================="
        Write-Output "LISTING CONTENTS OF PROGRAM FILES (up to 3 levels deep)"
        Write-Output "=================================================="
        # سنقوم بعرض محتويات مجلدات البرامج لعمق 3 مستويات
        Get-ChildItem -Path "C:\Program Files", "C:\Program Files (x86)" -Depth 3 -ErrorAction SilentlyContinue